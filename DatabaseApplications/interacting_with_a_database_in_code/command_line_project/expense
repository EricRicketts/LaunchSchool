#! /usr/bin/env ruby
require 'pry-byebug'
require 'pg'

class TableFormat
  OFFSET = 2
  attr_accessor :headers, :body

  def initialize(result_obj, headers, body)
    @headers = init_header_hsh(headers, result_obj)
    @body = body
  end

  def print_table
    print_headers
  end

  private

  def init_header_hsh(column_names, result_obj)
    self.headers = column_names.to_h do |name|
      [name, result_obj.field_values(name).map(&:length).max + OFFSET]
    end
  end

  def print_headers
    col_names = headers.inject([]) do |columns, (name, spacing)|
      columns << name.rjust(spacing)
    end
    separator = headers.inject([]) do |str, (_, spacing)|
      str << '-' * spacing
    end

    col_names.join('|').concat("\n") + separator.join('+').concat("\n")
  end
end


conn = PG::Connection.new(dbname: 'rb185')

sql_for_list = <<SQL_LIST
SELECT *
FROM expenses;
SQL_LIST

result = conn.exec(sql_for_list)
tf = TableFormat.new(result, result.fields, result.values)
binding.pry
p tf.body

conn.close






